{{#
    Google Tag Manager Integration
    
    Loading Strategy: always (defined in GoogleTagIntegration.php)
    Uses Google Consent Mode v2 - loads immediately but respects consent signals.
    
    Available variables:
    - config.measurement_id: The Google Tag Measurement ID
    - config.consent_mapping: Service handle to storage type mapping
    - config.placement: Current placement (head or body)
#}}
{{ if config:placement == "body" }}
<script async src="https://www.googletagmanager.com/gtag/js?id={{ config:measurement_id }}"></script>
<script>
window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
window.gtag = window.gtag || gtag;
gtag('consent','default', {
  'ad_storage': 'denied',
  'ad_user_data': 'denied',
  'ad_personalization': 'denied',
  'analytics_storage': 'denied',
  'functionality_storage': 'denied',
  'personalization_storage': 'denied',
  'security_storage': 'granted'
});
gtag('js', new Date());
gtag('config','{{ config:measurement_id }}');
</script>
<script type="module" src="{{ vite:asset src='resources/js/integrations/GoogleTagIntegration.js' directory='vendor/statamic-consent-manager/frontend' }}"></script>
{{ /if }}
